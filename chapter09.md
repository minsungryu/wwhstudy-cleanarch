# 애플리케이션 조립하기

## 왜 조립까지 신경 써야 할까?

코드 의존성이 올바른 방향을 가리키게 하기 위함이다.

만약 유스케이스가 영속성 어댑터를 호출해야 하고 스스로 인스턴스화한다면 코드 의존성이 잘못된 방향으로 만들어진 것이다.

이것이 바로 아웃고잉 포트 인터페이스를 생성한 이유다. 유스케이스는 인터페이스만 알아야 하고, 런타임에 이 인터페이스의 구현을 제공받아야 한다.

(그림 9.1)

아키텍처에 대해 중립적이고 인스턴스 생성을 위해 모든 클래스에 대한 의존성을 가지는 설정 컴포넌트가 있어야 한다.

이 설정 컴포넌트는 의존성 규칙에 정의된 대로 모든 내부 계층에 접근할 수 있는 원의 가장 바깥쪽에 위치한다.

설정 컴포넌트는 다음과 같은 역할을 수행해야 한다.

- 웹 어댑터 인스턴스 생성
- HTTP 요청이 실제로 웹 어댑터로 전달되도록 보장
- 유스케이스 인스턴스 생성
- 웹 어댑터에 유스케이스 인스턴스 제공
- 영속성 어댑터 인스턴스 생성
- 유스케이스에 영속성 어댑터 인스턴스 제공
- 영속성 어댑터가 실제로 데이터베이스에 접근할 수 있도록 보장

이 설정 컴포넌트는 책임(변경할 이유)이 굉장히 많다.

이는 단일 책임 원칙을 위반하지만 애플리케이션의 나머지 부분을 깔끔하게 유지하기 위한 선택이다.

## 평범한 코드로 조립하기

main 메서드 안에서 웹 컨트롤러부터 영속성 어댑터까지 필요한 모든 클래스의 인스턴스를 생성한 후 연결한다.

가장 기본적인 방법이지만 엔터프라이즈 애플리케이션을 구동하기 위해서 너무 많은 코드가 필요하다.

또한 각 클래스가 속한 패키지 외부에서 인스턴스를 생성하기 때문에 전부 `public`이어야 한다.

## 스프링의 클래스패스 스캐닝으로 조립하기

프레임워크에 특화되었다는 점에서 침투적이다.

또한 다른 개발자를 위한 라이브러리의 경우 스프링 프레임워크 의존성에 엮이게 되므로 사용하지 말아야 한다.

스프링 전문가가 아닐 경우 '마법 같은' 일이 일어나므로 유지보수에 어려움이 있을 것이다.

## 스프링의 자바 컨피그로 조립하기

`@Configuration` 애너테이션을 통해 빈을 선언한다.

각 계층의 특정 모듈을 위한 설정 클래스를 만들면 테스트에 큰 유연성이 생긴다.

또한 `@Component` 애너테이션을 붙이지 않아도 되므로 프레임워크 의존성 없이 깔끔하게 유지할 수 있다.

다만 설정 클래스와 생성하려는 빈이 같은 패키지에 존재하지 않는다면 `public`으로 만들어야 한다.

---

질문 1.